# https://taskfile.dev

version: '3'

tasks:
  setup:infra:
    cmds:
      - azd auth login
      - azd up
  setup:devtunnel:
    cmds:
      - |
        devtunnel login
        TUNNEL_NAME="aicontactcentre-$(azd env get-values | grep AZURE_ENV_NAME | cut -d'=' -f2 | tr -d '"' || echo "$(date +%s)")"
        echo "Creating devtunnel with name: $TUNNEL_NAME"
        devtunnel create $TUNNEL_NAME --allow-anonymous
        devtunnel port create -p 8000
  run:devtunnel:
    cmds:
      - |
        TUNNEL_NAME="aicontactcentre-$(azd env get-values | grep AZURE_ENV_NAME | cut -d'=' -f2 | tr -d '"' || echo "$(date +%s)")"
        echo "Hosting devtunnel: $TUNNEL_NAME"
        devtunnel host $TUNNEL_NAME
  run:api:
    dir: api
    cmds:
      - uv run fastapi dev
  run:
    deps: [run:devtunnel, run:api]
  eval:
    dir: eval
    cmds:
      - uv run main.py
